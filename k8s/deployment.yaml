apiVersion : app/v1
kind: Deployment
metadata :
  name : my-app
  namespace: default
spec :
  replicas : 2
  selector :
    matchLabels :
      app : my-app
  template :
    metadata :
      labels :
        app : my-app
    spec :
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        fsGroup: 1000
      containers :
        - name : my-app
          image : 202533513649.dkr.ecr.eu-west-1.amazonaws.com/my-app:v1.0.0
          ports :
            - containerPort : 8080
              protocol : TCP
          resources :
            requests :
              memory : "128Mi"
              cpu : "100m"
            limits :
              memory : "256Mi"
              cpu : "200m"
          livenessProbe :
            httpGet :
              path : /health
              port : 8080
            initialDelaySeconds : 30
            periodSeconds : 10
            timeoutSeconds : 5
            failureThreshold : 3
          readinessProbe :
            httpGet :
              path : /health 
              port : 8080
            initialDelaySeconds : 30
            periodSeconds : 10
            timeoutSeconds : 5
            failureThreshold : 3
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: false
            capabilities:
              drop:
                - ALL
          
